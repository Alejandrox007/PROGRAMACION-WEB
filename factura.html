<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nueva Factura - Amazon Business</title>
    <link rel="stylesheet" href="./public/css/style.css" />
    <link rel="stylesheet" href="./public/css/client-card.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛒</text></svg>"
    />
  </head>
  <body>
    <header>
      <div class="header-content">
        <a href="index.html" class="logo">🛒 Amazon Business</a>
        <nav>
          <ul>
            <li><a href="index.html#productos">Catálogo</a></li>
            <li><a href="factura.html" class="active">Nueva Factura</a></li>
            <li><a href="index.html#historial">Facturas</a></li>
            <li><a href="#" id="nav-admin" onclick="mostrarLoginAdmin()">Admin</a></li>
            <li id="logout-nav-item" style="display: none;">
              <a href="#" id="logout-link" class="logout-link" onclick="cerrarSesionAdmin()">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <section id="facturacion" class="active">
        <div class="invoice-header">
          <h2><i class="fas fa-file-invoice-dollar"></i> Sistema de Facturación</h2>
          <div class="invoice-number">
            <span>Factura #<span id="invoice-number">FAC-001</span></span>
          </div>
        </div>

        <div class="invoice-container">
          <div class="invoice-left-panel">
            <div class="invoice-card">
              <div class="card-header">
                <h3><i class="fas fa-user-circle"></i> Cliente</h3>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label>
                    <i class="fas fa-users"></i> Cliente para la Factura
                  </label>
                  <div class="form-row">
                    <div class="form-group" style="width: auto;">
                      <button type="button" class="btn btn-primary" id="btn-nuevo-cliente">
                        <i class="fas fa-user-plus"></i> Agregar Cliente
                      </button>
                    </div>
                  </div>
                </div>
                <div id="selected-client-info" class="client-preview d-none">
                  <div class="client-card">
                    <img id="client-avatar" src="" alt="Cliente" class="client-avatar">
                    <div class="client-details">
                      <h4 id="client-name">-</h4>
                      <p id="client-email">-</p>
                      <p id="client-phone">-</p>
                      <p id="client-cedula">-</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="invoice-card">
              <div class="card-header">
                <h3><i class="fas fa-shopping-bag"></i> Productos</h3>
              </div>
              <div class="card-body">
                <div class="product-selector">
                  <!-- Agregar sección de búsqueda y filtros -->
                  <div class="search-section">
                    <div class="search-container">
                      <input type="text" id="search-products" placeholder="Buscar productos..." class="search-input">
                      <button class="search-btn" onclick="buscarProductos()">
                        <i class="fas fa-search"></i>
                      </button>
                    </div>
                  </div>
                  <!-- Catálogo de productos -->
                  <div id="products-catalog" class="products-catalog">
                    <!-- Los productos se insertarán aquí dinámicamente -->
                  </div>
                  <!-- Formulario de cantidad -->
                  <div class="form-row" style="margin-top: 20px;">
                    <div class="form-group">
                      <label for="product-quantity">Cantidad</label>
                      <input type="number" id="product-quantity" value="1" min="1" class="form-control">
                    </div>
                    <div class="form-group">
                      <label>&nbsp;</label>
                      <button type="button" class="btn btn-primary" onclick="agregarProductoSeleccionadoAFactura()" disabled>
                        <i class="fas fa-plus"></i> Agregar a Factura
                      </button>
                    </div>
                  </div>
                </div>
                <div id="invoice-items-container" class="invoice-items">
                  <div class="empty-items">
                    <i class="fas fa-clipboard-list"></i>
                    <p>No hay productos agregados</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="invoice-card">
              <div class="card-header">
                <h3><i class="fas fa-info-circle"></i> Información Adicional</h3>
              </div>
              <div class="card-body">
                <div class="form-group">
                  <label for="payment-method">
                    <i class="fas fa-credit-card"></i> Método de Pago
                  </label>
                  <select id="payment-method" class="form-control">
                    <option value="efectivo">Efectivo</option>
                    <option value="transferencia">Transferencia Bancaria</option>
                    <option value="tarjeta">Tarjeta de Crédito</option>
                    <option value="cheque">Cheque</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>
                    <i class="fas fa-map-marker-alt"></i> Ubicación (Opcional)
                  </label>
                  <button type="button" id="capture-location-btn" class="btn btn-outline-secondary btn-sm" onclick="obtenerUbicacion()">
                    <i class="fas fa-location-arrow"></i> Capturar Ubicación
                  </button>
                  <div id="location-info" class="location-display">
                    <p id="location-status" class="location-status">📍 Sin ubicación</p>
                    <div id="location-details" class="d-none">
                      <div class="location-coords">
                        <p><strong>Coordenadas:</strong> 
                          <span id="location-lat">-</span>, <span id="location-lng">-</span>
                        </p>
                        <p id="location-address-display" class="d-none">
                          <strong>Zona:</strong> <span id="location-address-text">-</span>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="invoice-right-panel">
            <div class="invoice-summary-card">
              <div class="card-header">
                <h3><i class="fas fa-calculator"></i> Resumen de Factura</h3>
              </div>
              <div class="card-body">
                <div class="invoice-totals">
                  <div class="summary-line">
                    <span>Subtotal:</span>
                    <span id="invoice-subtotal">$0.00</span>
                  </div>
                  <div class="summary-line">
                    <span>IVA (12%):</span>
                    <span id="invoice-tax">$0.00</span>
                  </div>
                  <hr class="summary-divider">
                  <div class="summary-total">
                    <span>Total:</span>
                    <span id="invoice-total">$0.00</span>
                  </div>
                </div>
                <div class="invoice-actions">
                  <button id="clear-invoice-btn" class="btn btn-outline-secondary btn-block">
                    <i class="fas fa-undo"></i> Limpiar Factura
                  </button>
                  <button id="generate-invoice-btn" class="btn btn-success btn-lg btn-block">
                    <i class="fas fa-file-invoice"></i> Generar Factura
                  </button>
                </div>
              </div>
            </div>
            <div class="invoice-preview-card">
              <div class="card-header">
                <h4><i class="fas fa-eye"></i> Vista Previa</h4>
              </div>
              <div class="card-body">
                <div class="invoice-preview">
                  <div class="preview-header">
                    <h5>Amazon Business</h5>
                    <p>Sistema de Facturación</p>
                  </div>
                  <div class="preview-client">
                    <p><strong>Cliente:</strong> <span id="preview-client-name">-</span></p>
                    <p><strong>Email:</strong> <span id="preview-client-email">-</span></p>
                  </div>
                  <div class="preview-items">
                    <p><strong>Productos:</strong> <span id="preview-items-count">0</span></p>
                    <p><strong>Total:</strong> <span id="preview-total">$0.00</span></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <h3 id="modal-title">Título del Modal</h3>
        <div id="modal-body">
        </div>
      </div>
    </div>

    <div id="toast-container"></div>

    <script src="./public/js/api.js"></script>
    <script src="./public/js/app.js"></script>
    <script>
      // Inicializar la página de facturación cuando el DOM esté listo
      document.addEventListener('DOMContentLoaded', function() {
        // La función inicializarPaginaFactura está en app.js
        inicializarPaginaFactura();
      });
    </script>
  </body>
</html>
