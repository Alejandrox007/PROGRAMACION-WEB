<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amazon Business - Sistema de Facturación</title>
    <link rel="stylesheet" href="./public/css/style.css" />
    <!-- Integración de Font Awesome para iconos -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛒</text></svg>"
    />
  </head>
  <body>
    <!-- =================================================================================
       HEADER Y NAVEGACIÓN PRINCIPAL
       ================================================================================= -->
    <header>
      <div class="header-content">
        <a href="index.html" class="logo">🛒 Amazon Business</a>
        <nav>
          <ul>
            <li>
              <a href="index.html#productos" id="nav-productos">Catálogo</a>
            </li>
            <li>
              <a href="factura.html" id="nav-facturacion">Nueva Factura</a>
            </li>
            <li>
              <a href="index.html#historial" id="nav-historial">Facturas</a>
            </li>
            <li>
              <a href="#" id="nav-admin">Admin</a>
            </li>
            <li id="logout-nav-item" style="display: none;">
              <a href="#" id="logout-link" class="logout-link" onclick="cerrarSesionAdmin()">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <!-- =================================================================================
           SECCIÓN CATÁLOGO DE PRODUCTOS
           ================================================================================= -->
      <section id="productos" class="active">
        <h2><i class="fas fa-boxes"></i> Catálogo de Productos</h2>
        <div class="catalog-actions">
          <button class="btn btn-primary" onclick="window.location.href='factura.html'">
            <i class="fas fa-file-invoice"></i> Crear Nueva Factura
          </button>
        </div>

        <!-- Filtros de categorías -->
        <div class="category-filters">
          <div class="filter-header">
            <h3><i class="fas fa-filter"></i> Filtrar por Categoría</h3>
          </div>
          <div class="filter-buttons">
            <button class="filter-btn active" data-category="todas" onclick="filtrarPorCategoria('todas')">
              <i class="fas fa-th"></i> Todas
            </button>
            <button class="filter-btn" data-category="tecnologia" onclick="filtrarPorCategoria('tecnologia')">
              <i class="fas fa-laptop"></i> Tecnología
            </button>
            <button class="filter-btn" data-category="audio" onclick="filtrarPorCategoria('audio')">
              <i class="fas fa-headphones"></i> Audio
            </button>
            <button class="filter-btn" data-category="monitores" onclick="filtrarPorCategoria('monitores')">
              <i class="fas fa-desktop"></i> Monitores
            </button>
            <button class="filter-btn" data-category="electrodomesticos" onclick="filtrarPorCategoria('electrodomesticos')">
              <i class="fas fa-tv"></i> Electrodomésticos
            </button>
          </div>
        </div>

        <!-- Barra de búsqueda -->
        <div class="search-section">
          <div class="search-container">
            <input type="text" id="search-products" placeholder="Buscar productos..." class="search-input">
            <button class="search-btn" onclick="buscarProductos()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>

        <!-- Información de resultados -->
        <div class="results-info">
          <span id="results-count">Mostrando todos los productos</span>
          <button id="clear-filters-btn" class="btn-clear-filters d-none" onclick="limpiarFiltros()">
            <i class="fas fa-times"></i> Limpiar filtros
          </button>
        </div>

        <div id="products-catalog" class="products-catalog">
          <!-- Las tarjetas de productos se insertarán aquí dinámicamente -->
        </div>
      </section>

      <!-- =================================================================================
           SECCIÓN HISTORIAL DE FACTURAS (MOVIDA A ADMIN)
           ================================================================================= -->
      
      <!-- =================================================================================
           SECCIÓN DE ADMINISTRACIÓN
           ================================================================================= -->
      <section id="admin">
        <!-- Contenido se muestra si el admin está logueado -->
        <div id="admin-content" class="d-none">
          <h2><i class="fas fa-user-shield"></i> Panel de Administración</h2>
          
          <div class="admin-section">
            <!-- Administración de Productos -->
            <div id="admin-products">
              <h3>Gestión de Productos</h3>
              <button class="btn btn-success" onclick="showEditProductModal()">
                <i class="fas fa-plus"></i> Agregar Nuevo Producto
              </button>
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Foto</th>
                    <th>Producto</th>
                    <th>Categoría</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-products-table">
                  <!-- Filas de productos se insertarán aquí -->
                </tbody>
              </table>
            </div>

            <!-- Administración de Clientes -->
            <div id="admin-clients">
              <h3>Gestión de Clientes</h3>
              <button class="btn btn-success" onclick="showEditClientModal()">
                <i class="fas fa-user-plus"></i> Agregar Nuevo Cliente
              </button>
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Foto</th>
                    <th>Información del Cliente</th>
                    <th>Email</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="admin-clients-table">
                  <!-- Filas de clientes se insertarán aquí -->
                </tbody>
              </table>
            </div>

            <!-- Historial de Facturas -->
            <div id="admin-invoices">
              <h3><i class="fas fa-history"></i> Historial de Facturas</h3>
              <div id="invoice-history-container">
                <!-- El historial de facturas se insertará aquí -->
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- =================================================================================
       MODAL UNIVERSAL PARA EDICIÓN Y FORMULARIOS
       ================================================================================= -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <h3 id="modal-title">Título del Modal</h3>
        <div id="modal-body">
          <!-- El contenido del formulario se insertará aquí dinámicamente -->
        </div>
      </div>
    </div>

    <!-- =================================================================================
       CONTENEDOR PARA NOTIFICACIONES (TOAST)
       ================================================================================= -->
    <div id="toast-container"></div>

    <!-- =================================================================================
       SCRIPTS
       ================================================================================= -->
    <script src="./public/js/api.js"></script>
    <script src="./public/js/app.js"></script>
    <script>
      // Asegurar que el botón de Admin muestre el formulario de inicio de sesión
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('nav-admin').addEventListener('click', function(e) {
          e.preventDefault();
          if (isAdmin) {
            showSection('admin');
          } else {
            mostrarLoginAdmin();
          }
        });

        // Load initial data
        cargarDatos();
        cargarDatosEjemplo();
        actualizarVistaProductos();

        // Initialize admin state
        verificarAutenticacionAdmin();

        // Show products section by default
        showSection('productos');
      });
    </script>
  </body>
</html>
